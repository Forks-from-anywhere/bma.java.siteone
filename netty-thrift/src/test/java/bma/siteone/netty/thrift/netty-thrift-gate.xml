<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:util="http://www.springframework.org/schema/util"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
	http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-3.0.xsd">

	<!-- main thread -->
	<bean id="mainThread" class="bma.common.langutil.ai.common.AIExecutorMain" />
	<!-- sync thread pool -->
	<bean id="syncExecutor" class="bma.common.langutil.ai.common.AIExecutorJava">
		<property name="executor">
			<bean
				class="org.springframework.scheduling.concurrent.ThreadPoolExecutorFactoryBean">
				<property name="threadNamePrefix" value="threadPool-" />
				<property name="corePoolSize" value="5" />
				<property name="maxPoolSize" value="100" />
				<property name="keepAliveSeconds" value="60" />
			</bean>
		</property>
	</bean>
	<!-- ai thread -->
	<bean id="aiExecutor" class="bma.common.langutil.ai.common.AIExecutorJava">
		<property name="executor">
			<bean
				class="org.springframework.scheduling.concurrent.ThreadPoolExecutorFactoryBean">
				<property name="threadNamePrefix" value="aithread-" />
				<property name="corePoolSize" value="1" />
				<property name="maxPoolSize" value="1" />
			</bean>
		</property>
	</bean>
	<!-- timer -->
	<bean id="aitimer" class="bma.common.langutil.concurrent.TimerManager">
		<property name="executor" ref="syncExecutor"/>
	</bean>

	<!-- netty client support -->
	<bean id="nettyClientBootstrap" class="bma.common.netty.client.NettyClientBootstrap"
		init-method="init">
		<property name="worker" value="3" />
	</bean>
	<bean id="aiThriftEntry" class="bma.siteone.netty.thrift.client.AIThriftEntryNetty">
		<property name="bootstrap" ref="nettyClientBootstrap" />
		<property name="traceBufferSize" value="0" />
	</bean>

	<!-- ip limit -->
	<bean id="secureFilter" class="bma.siteone.netty.thrift.common.ThriftIpLimit"
		init-method="init">
		<property name="whiteAddress">
			<value></value>
		</property>
	</bean>
	
	<bean id="nettyPool" class="bma.common.netty.pool.NettyChannelPool" destroy-method="close">
		<property name="maxActive" value="10"/>
		<property name="idleMaxTime" value="300000"/>
		<property name="timer" ref="aitimer"/>
		<property name="factory">
			<bean class="bma.common.netty.pool.SimpleNettyChannelPoolFactory">
				<property name="bootstrap" ref="nettyClientBootstrap"/>				
			</bean>
		</property>
	</bean>
	<bean id="gateDispatcher" class="bma.siteone.netty.thrift.gate.impl.NTGDispatcherCore">
		<property name="serviceHost">
			<map>
				<entry key="cloud" value="172.19.16.195:9192"/>
				<entry key="admin" value="172.19.16.195:9191"/>
			</map>
		</property>
	</bean>

	<bean id="thriftGateServer" class="bma.siteone.netty.thrift.gate.NettyThriftGate"
		destroy-method="close">
		<property name="name" value="thriftGate" />
		<property name="port" value="9080"/>
		<property name="worker" value="5" />
		<property name="traceBufferSize" value="256" />
		<property name="Pipelines">
			<list>
				<ref bean="secureFilter" />
			</list>
		</property>		
		<property name="frameSize" value="10m"/>
		<property name="pool" ref="nettyPool" />
		<property name="dispatcher" ref="gateDispatcher" />
	</bean>	
	
	<bean id="booter" class="bma.common.langutil.spring.SimpleServerBooter">
        <property name="mainList">
        	<list>        		
        		<ref bean="thriftGateServer"/>   
        	</list>
        </property>
    </bean>	  

</beans>
