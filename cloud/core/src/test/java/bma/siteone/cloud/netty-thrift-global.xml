<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:util="http://www.springframework.org/schema/util"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
	http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-3.0.xsd">

	<!-- timer -->
	<bean id="aitimer" class="bma.common.langutil.concurrent.TimerManager"
		init-method="startManager" destroy-method="stopManager"/>
	<!-- main thread -->
	<bean id="mainThread" class="bma.common.langutil.ai.common.AIExecutorMain" />
	<!-- sync thread pool -->
	<bean id="syncExecutor" class="bma.common.langutil.ai.common.AIExecutorJava">
		<property name="executor">
			<bean
				class="org.springframework.scheduling.concurrent.ThreadPoolExecutorFactoryBean">
				<property name="threadNamePrefix" value="threadPool-" />
				<property name="corePoolSize" value="${threadpool.corePoolSize}" />
				<property name="maxPoolSize" value="${threadpool.maxPoolSize}" />
				<property name="keepAliveSeconds" value="${threadpool.keepAliveSeconds}" />
			</bean>
		</property>
	</bean>
	<!-- ai thread -->
	<bean id="aiExecutor" class="bma.common.langutil.ai.common.AIExecutorJava">
		<property name="executor">
			<bean
				class="org.springframework.scheduling.concurrent.ThreadPoolExecutorFactoryBean">
				<property name="threadNamePrefix" value="aithread-" />
				<property name="corePoolSize" value="${aithread.corePoolSize}" />
				<property name="maxPoolSize" value="${aithread.maxPoolSize}" />
			</bean>
		</property>
	</bean>
	
	<!-- runtime config -->
	<bean id="runtimeConfig" class="bma.common.langutil.runtime.RuntimeConfig"
		init-method="init" destroy-method="close">
		<!--
		<property name="checkTime" value="5s"/>
		 -->
		<property name="executor">
			<bean class="bma.common.langutil.concurrent.ScheduledExecutorTM">
				<constructor-arg><ref bean="aitimer"/></constructor-arg>
			</bean>
		</property>
		<property name="files">
			<list>
				<value>${runtime.config.path}config1.properties</value>
				<value>${runtime.config.path}config2.properties</value>
				<value>${runtime.config.path}config3.properties</value>
			</list>
		</property>
	</bean>

	<!-- netty client support -->
	<bean id="nettyClientBootstrap" class="bma.common.netty.client.NettyClientBootstrap"
		init-method="init">
		<property name="worker" value="${netty.client.worker}" />
	</bean>
	<bean id="aiThriftEntry" class="bma.siteone.netty.thrift.client.AIThriftEntryNetty">
		<property name="bootstrap" ref="nettyClientBootstrap" />
		<property name="traceBufferSize" value="0" />
	</bean>

	<!-- ip limit -->
	<bean id="secureFilter" class="bma.siteone.netty.thrift.common.ThriftIpLimit"
		init-method="init">
		<property name="whiteAddress" value="${thrift.whiteAddress}"/>
		<property name="runtimeConfig" ref="runtimeConfig"/>
	</bean>

	<bean id="thriftServiceServer" class="bma.siteone.netty.thrift.core.NettyThriftServer"
		destroy-method="close">
		<property name="name" value="thriftService" />
		<property name="worker" value="${netty.server.worker}" />
		<property name="traceBufferSize" value="256" />
		<property name="Pipelines">
			<list>
				<ref bean="secureFilter" />
			</list>
		</property>
		<property name="node" ref="thriftServiceNode" />
		<property name="processExecutor" ref="syncExecutor" />
	</bean>

	<!-- 
	<bean id="thriftManageServer" class="bma.siteone.netty.thrift.core.NettyThriftServer"
		destroy-method="close">
		<property name="name" value="thriftManage" />
		<property name="worker" value="2" />
		<property name="traceBufferSize" value="0" />
		<property name="Pipelines">
			<list>
				<ref bean="secureFilter" />
			</list>
		</property>
		<property name="node" ref="thriftManageNode" />
		<property name="processExecutor" ref="syncExecutor" />
	</bean>
	 -->

</beans>
