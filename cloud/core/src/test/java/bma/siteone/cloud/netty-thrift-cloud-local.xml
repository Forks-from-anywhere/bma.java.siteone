<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:context="http://www.springframework.org/schema/context"
	xmlns:aop="http://www.springframework.org/schema/aop" xmlns:tx="http://www.springframework.org/schema/tx"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
                     http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
                     http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd
                     http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.0.xsd
                     http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-3.0.xsd">
                     
	<bean id="CONFIG" class="org.springframework.beans.factory.config.PropertiesFactoryBean">
		<property name="properties">
			<props>
				<prop key="threadpool.corePoolSize">5</prop>
				<prop key="threadpool.maxPoolSize">100</prop>
				<prop key="threadpool.keepAliveSeconds">60</prop>
				<prop key="aithread.corePoolSize">1</prop>
				<prop key="aithread.maxPoolSize">1</prop>
				<prop key="runtime.config.path">e:/tmp/</prop>
				<prop key="netty.client.worker">3</prop>
				<prop key="netty.server.worker">5</prop>
				<prop key="thrift.node1.name">testNode1</prop>
				<prop key="thrift.node1.host">172.19.16.78</prop>
				<prop key="thrift.node1.port">9080</prop>				
				<prop key="thrift.whiteAddress"></prop>				
			</props>
		</property>
	</bean>
	<context:property-placeholder properties-ref="CONFIG"/>
	<!--
	<context:property-placeholder location="classpath:service.properties" /> 
	 -->	 	
	
	<import resource="netty-thrift-global.xml"/>
	<!-- 
	<import resource="netty-thrift-peer.xml"/>
	 -->	
	 
	<!-- Service Object -->
	<bean id="cloudNode1" class="bma.siteone.cloud.local.LocalCloudNode">
		<property name="nodeId" value="node1"/>
		<property name="title" value="test CloudNode"/>
		<property name="apps">
			<list>
				<bean class="bma.siteone.cloud.common.CloudApp4ThriftView">
					<property name="appId" value="thrift_view"/>
					<property name="appName" value="testapp"/>
					<property name="thriftNodeBean" value="thriftServiceNode"/>
				</bean>
				<bean class="bma.siteone.cloud.local.LocalCloudApp">
					<property name="appId" value="app1"/>
					<property name="appName" value="testapp"/>
					<property name="title" value="test Cloud App"/>
					<property name="services">
						<list>
							<bean class="bma.siteone.cloud.impl.LocalCloudService4Test">
								<property name="serviceId" value="s1"/>
							</bean>
							<bean class="bma.siteone.cloud.local.SimpleLocalCloudService">
								<property name="serviceId" value="manageService"/>
								<property name="title" value="服务器管理服务"/>
								<property name="apis">
									<list>
										<bean class="bma.siteone.cloud.common.CloudApi4Shutdown">
											<property name="apiId" value="shutdown"/>
											<property name="confirmWord" value="shutdown"/>
											<property name="apiDesc">
												<map>
													<entry key="phpagent" value="bma\cloud\common\Agent4Shutdown"/>
												</map>
											</property>
										</bean>										
										<bean class="bma.siteone.cloud.common.CloudApi4GC">
											<property name="apiId" value="gc"/>
											<property name="apiDesc">
												<map>
													<entry key="phpagent" value="bma\cloud\common\Agent4GC"/>
												</map>
											</property>
										</bean>										
										<bean class="bma.siteone.cloud.common.CloudApi4RuntimeConfig">
											<property name="apiId" value="runtimeConfig"/>
											<property name="config" ref="runtimeConfig"/>
											<property name="fileName" value="config1"/>
											<property name="apiDesc">
												<map>
													<entry key="phpagent" value="bma\cloud\common\Agent4RuntimeConfig"/>
												</map>
											</property>
										</bean>										
									</list>
								</property>
							</bean>
						</list>
					</property>
				</bean>			
				<bean class="bma.siteone.cloud.local.LocalCloudApp">
					<property name="appId" value="app2"/>
					<property name="appName" value="testapp"/>
					<property name="title" value="test Cloud App 2"/>
					<property name="services">
						<list>
							<bean class="bma.siteone.cloud.impl.LocalCloudService4Test">
								<property name="serviceId" value="s1"/>
							</bean>
						</list>
					</property>
				</bean>
			</list>
		</property>
	</bean>

	<!-- ThriftServiceNode -->
	<bean id="serviceCloudNode1" class="bma.siteone.cloud.impl.Cloud4ThriftAISimple">
		<property name="cloudNodes">
			<list>
				<ref bean="cloudNode1"/>
			</list>
		</property>
		<property name="thriftTitle" value="${thrift.node1.name}-${thrift.node1.host}-${thrift.node1.port}"/>
	</bean>
	<bean id="atpCloudNode1" class="bma.siteone.cloud.thrift.TAICloud.Processor">		
		<constructor-arg ref="serviceCloudNode1" />
	</bean>
	<bean id="tbeanCloudNode1" class="bma.common.thrift.servicehub.ThriftServiceBean">
		<property name="module" value="cloud"/>
		<property name="processor" ref="atpCloudNode1"/>
	</bean>	
	<bean id="thriftServiceNode" class="bma.common.thrift.servicehub.ThriftServiceNode">
		<property name="name" value="${thrift.node1.name}"/>
		<property name="type" value="socket"/>
		<property name="accessHost" value="${thrift.node1.host}"/>
		<property name="port" value="${thrift.node1.port}" />				
		<property name="frameSize" value="10m"/>
		<property name="defaultModule" value="cloud"/>
		<property name="services">
			<list>
				<ref bean="tbeanCloudNode1"/>				
			</list>
		</property>
	</bean>

	<!-- BOOT -->
	<!-- bma.common.langutil.ai.boot.AIServerBoot -->	
	<!-- booter -->
	<bean id="booter" class="bma.common.langutil.spring.SimpleServerBooter">
        <property name="mainList">
        	<list>        		
        		<ref bean="thriftServiceServer"/>   
        	</list>
        </property>
    </bean>	  

</beans>
